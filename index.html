<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Availability App - ç”¢å“è¦æ ¼äº’å‹•å±•ç¤º</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Custom Scrollbar for inner elements */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f5f9; 
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
    </style>
</head>
<body class="bg-stone-50 text-slate-800 font-sans selection:bg-indigo-100 selection:text-indigo-700">

    <!-- Chosen Palette: Warm Neutral Tech (Stone/Slate) with Indigo Primary and Amber/Emerald Accents -->
    <!-- Application Structure Plan: 
         1. Header: Spec Title & Core Value Proposition.
         2. Interactive Prototype (The Core): A functional simulation of the App's flow (Organizer -> Participant -> Result) running side-by-side with 'Live Spec Annotations' that explain the rules active in each step.
         3. Logic Deep Dive: Visualizing the Heatmap Algorithm.
         4. Data Model: Firestore schema viewer.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <!-- Main Container -->
    <div class="max-w-6xl mx-auto px-4 py-8 space-y-12">

        <!-- Header Section -->
        <header class="text-center space-y-4 animate-fade-in-down">
            <div class="inline-block px-3 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-semibold tracking-wide uppercase">ç”¢å“è¦æ ¼æ›¸ v1.7</div>
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900 tracking-tight">Event Availability Scheduling App</h1>
            <p class="text-lg text-slate-600 max-w-2xl mx-auto">
                ä¸€å€‹è§£æ±ºã€Œå¤šäººå–¬æ™‚é–“ã€ç—›é»çš„è¡Œå‹•å„ªå…ˆç¶²é æ‡‰ç”¨ã€‚æœ¬é é¢å°‡ç”¢å“è¦æ ¼è½‰åŒ–ç‚ºäº’å‹•é«”é©—ï¼Œå¸¶æ‚¨æ·±å…¥äº†è§£æµç¨‹ã€é‚è¼¯èˆ‡è³‡æ–™çµæ§‹ã€‚
            </p>
            
            <!-- Core Values Grid -->
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                    <div class="text-2xl mb-2">ğŸ“±</div>
                    <h3 class="font-bold text-slate-800">Mobile First</h3>
                    <p class="text-xs text-slate-500">é‡å°å–®æ‰‹æ“ä½œå„ªåŒ–çš„ä»‹é¢è¨­è¨ˆ</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                    <div class="text-2xl mb-2">âš¡</div>
                    <h3 class="font-bold text-slate-800">ç›´è¦ºå¿«é€Ÿ</h3>
                    <p class="text-xs text-slate-500">åƒèˆ‡è€…ç„¡éœ€è¨»å†Šï¼Œé»æ“Šå³ç”¨</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                    <div class="text-2xl mb-2">ğŸ“Š</div>
                    <h3 class="font-bold text-slate-800">å³æ™‚çµ±è¨ˆ</h3>
                    <p class="text-xs text-slate-500">è‡ªå‹•è¨ˆç®—ä¸¦é«˜äº®æœ€ä½³æ—¥æœŸ</p>
                </div>
                <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                    <div class="text-2xl mb-2">ğŸ›¡ï¸</div>
                    <h3 class="font-bold text-slate-800">å¾Œå°ç®¡ç†</h3>
                    <p class="text-xs text-slate-500">ç™¼èµ·äººå¯ç§»é™¤åå–®èˆ‡æŠ•ç¥¨</p>
                </div>
            </div>
        </header>

        <hr class="border-stone-200">

        <!-- Interactive Prototype Section -->
        <section id="prototype-section" class="space-y-6">
            <div class="md:flex justify-between items-end">
                <div>
                    <h2 class="text-3xl font-bold text-slate-800">äº’å‹•å¼æµç¨‹æ¨¡æ“¬ (Interactive Walkthrough)</h2>
                    <p class="text-slate-600 mt-2">è«‹æ“ä½œä¸‹æ–¹çš„æ¨¡æ“¬æ‰‹æ©Ÿä»‹é¢ï¼Œå³å´å°‡å³æ™‚é¡¯ç¤ºå°æ‡‰çš„è¦æ ¼èªªæ˜ã€‚</p>
                </div>
                <div class="flex space-x-2 mt-4 md:mt-0">
                    <button onclick="resetSimulation()" class="px-4 py-2 bg-slate-200 hover:bg-slate-300 text-slate-700 rounded-lg text-sm font-medium transition">âŸ³ é‡ç½®æµç¨‹</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 items-start">
                
                <!-- Left: The Phone Simulator -->
                <div class="lg:col-span-5 flex justify-center">
                    <div class="relative w-[320px] h-[640px] bg-slate-900 rounded-[3rem] shadow-2xl border-8 border-slate-900 overflow-hidden ring-4 ring-slate-200/50">
                        <!-- Dynamic Screen Content -->
                        <div id="app-screen" class="w-full h-full bg-stone-50 relative overflow-y-auto flex flex-col">
                            <!-- Content injected via JS -->
                        </div>
                        
                        <!-- Home Indicator -->
                        <div class="absolute bottom-1 left-1/2 transform -translate-x-1/2 w-1/3 h-1 bg-slate-600 rounded-full opacity-50"></div>
                    </div>
                </div>

                <!-- Right: Spec Annotations (Contextual) -->
                <div class="lg:col-span-7 space-y-6">
                    <div id="spec-card" class="bg-white p-6 rounded-2xl shadow-lg border-l-4 border-indigo-500 transition-all duration-300">
                        <div class="flex items-center space-x-2 mb-4">
                            <span id="step-badge" class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded text-xs font-bold uppercase tracking-wider">Step 1: Landing</span>
                            <h3 id="spec-title" class="text-xl font-bold text-slate-800">ç™¼èµ·äººæµç¨‹ï¼šå»ºç«‹æ´»å‹•</h3>
                        </div>
                        <div id="spec-content" class="text-slate-600 space-y-3 leading-relaxed">
                            <p>æ­¤éšæ®µå°æ‡‰è¦æ ¼æ›¸ <strong>2.1 ç™¼èµ·äººæµç¨‹</strong>ã€‚</p>
                            <ul class="list-disc list-inside space-y-1 text-sm bg-slate-50 p-3 rounded-lg">
                                <li>é»æ“Š CTA æŒ‰éˆ•ï¼šã€Œå»ºç«‹æ–°æ´»å‹•ã€ã€‚</li>
                                <li>ç³»çµ±å°‡è‡ªå‹•é–å®šèµ·å§‹æ—¥ç‚º <strong>Today</strong>ï¼ŒçµæŸæ—¥ç‚º <strong>Today + 60 days</strong> (èƒŒæ™¯åŸ·è¡Œ)ã€‚</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Flow Diagram (Static Visual context) -->
                    <div class="bg-slate-100 p-4 rounded-xl border border-slate-200">
                        <h4 class="text-sm font-semibold text-slate-500 uppercase mb-3">ç•¶å‰æµç¨‹ä½ç½®</h4>
                        <div class="flex items-center justify-between text-xs text-center">
                            <div id="flow-step-1" class="flex-1 p-2 bg-indigo-600 text-white rounded shadow-sm transition-colors">å»ºç«‹</div>
                            <span class="text-slate-300 mx-1">â†’</span>
                            <div id="flow-step-2" class="flex-1 p-2 bg-slate-200 text-slate-500 rounded transition-colors">åˆ†äº«</div>
                            <span class="text-slate-300 mx-1">â†’</span>
                            <div id="flow-step-3" class="flex-1 p-2 bg-slate-200 text-slate-500 rounded transition-colors">åƒèˆ‡</div>
                            <span class="text-slate-300 mx-1">â†’</span>
                            <div id="flow-step-4" class="flex-1 p-2 bg-slate-200 text-slate-500 rounded transition-colors">çµ±è¨ˆ</div>
                        </div>
                    </div>

                    <!-- Key Rules Callout -->
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-amber-50 p-4 rounded-xl border border-amber-100">
                            <h5 class="text-amber-800 font-bold text-sm mb-1">âš ï¸ é—œéµé™åˆ¶</h5>
                            <p class="text-amber-700 text-xs">æ—¥æœŸç¯„åœå›ºå®šç‚ºã€Œæœªä¾† 2 å€‹æœˆã€ï¼Œç™¼èµ·äººç„¡éœ€æ‰‹å‹•è¨­å®šçµæŸæ™‚é–“ã€‚</p>
                        </div>
                        <div class="bg-emerald-50 p-4 rounded-xl border border-emerald-100">
                            <h5 class="text-emerald-800 font-bold text-sm mb-1">âœ… é«”é©—ç›®æ¨™</h5>
                            <p class="text-emerald-700 text-xs">åŒååƒèˆ‡è€…å†æ¬¡é€²å…¥æ™‚ï¼Œæ‡‰è‡ªå‹•è¼‰å…¥èˆŠè³‡æ–™ä¸¦å…è¨±ã€Œä¿®æ”¹è¦†è“‹ã€ï¼Œè€Œéæ–°å¢ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Logic Deep Dive: Heatmap Visualization -->
        <section class="bg-white rounded-2xl shadow-sm border border-stone-200 overflow-hidden">
            <div class="p-6 border-b border-stone-100">
                <h2 class="text-2xl font-bold text-slate-800">3.3 çµæœè¦–è¦ºåŒ–é‚è¼¯ (Dot Voting)</h2>
                <p class="text-slate-600 mt-1">ç³»çµ±å¦‚ä½•å‘ˆç¾å¤šäººçš„é¸æ“‡ã€‚</p>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8 p-6">
                <div class="space-y-4">
                    <p class="text-slate-700">
                        ç‚ºäº†è®“ä½¿ç”¨è€…æ›´å®¹æ˜“çœ‹åˆ°ã€Œèª°é¸äº†é€™å¤©ã€ï¼Œæˆ‘å€‘æ¡ç”¨é»é»æŠ•ç¥¨ (Dot Voting) æ©Ÿåˆ¶ï¼š
                    </p>
                    <ul class="space-y-2 text-sm text-slate-600">
                        <li class="flex items-center"><span class="w-3 h-3 rounded-full bg-red-500 mr-2"></span> <strong>å°ˆå±¬é¡è‰²ï¼š</strong> æ¯ä½åƒèˆ‡è€…åœ¨è¼¸å…¥åç¨±æ™‚æœƒåˆ†é…ä¸€å€‹é¡è‰²ã€‚</li>
                        <li class="flex items-center"><span class="w-4 h-4 border border-slate-300 rounded mr-2 flex items-center justify-center"><div class="flex gap-0.5"><div class="w-1 h-1 bg-red-500 rounded-full"></div><div class="w-1 h-1 bg-blue-500 rounded-full"></div></div></span> <strong>æ—¥æ›†é¡¯ç¤ºï¼š</strong> æ—¥æœŸæ ¼å…§é¡¯ç¤ºæ‰€æœ‰é¸æ“‡è©²æ—¥çš„é¡è‰²é»é»ã€‚</li>
                        <li class="flex items-center"><span class="w-3 h-3 border-2 border-yellow-400 mr-2 rounded"></span> <strong>Best Dayï¼š</strong> äººæ•¸æœ€å¤šçš„æ—¥æœŸä¾ç„¶æœƒæ¨™è¨˜é‡‘è‰²é‚Šæ¡†ã€‚</li>
                    </ul>
                </div>
                
                <!-- Chart Container -->
                <div class="flex flex-col justify-center">
                    <div class="bg-slate-50 p-4 rounded-lg border border-slate-100">
                        <h4 class="text-xs font-bold text-slate-500 mb-2">è¦–è¦ºåŒ–ç¤ºæ„ (åƒèˆ‡è€… vs é»é»)</h4>
                        <div class="flex items-center space-x-4 mb-2">
                            <div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-pink-500"></span><span class="text-xs">Amy</span></div>
                            <div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-blue-500"></span><span class="text-xs">Bob</span></div>
                            <div class="flex items-center space-x-1"><span class="w-2 h-2 rounded-full bg-green-500"></span><span class="text-xs">Cat</span></div>
                        </div>
                        <div class="w-12 h-12 bg-white border rounded-lg flex flex-col items-center justify-center shadow-sm relative">
                            <span class="text-xs font-bold text-slate-400">12</span>
                            <div class="flex gap-1 mt-1">
                                <span class="w-1.5 h-1.5 rounded-full bg-pink-500"></span>
                                <span class="w-1.5 h-1.5 rounded-full bg-blue-500"></span>
                                <span class="w-1.5 h-1.5 rounded-full bg-green-500"></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Data Model Section -->
        <section>
            <h2 class="text-2xl font-bold text-slate-800 mb-6">4. è³‡æ–™æ¨¡å‹è¨­è¨ˆ (Firestore Schema)</h2>
            <div class="grid md:grid-cols-2 gap-6">
                <!-- Events Collection -->
                <div class="bg-slate-800 rounded-xl overflow-hidden shadow-lg">
                    <div class="bg-slate-900 px-4 py-2 border-b border-slate-700 flex justify-between items-center">
                        <span class="text-indigo-400 font-mono text-sm">Collection: events</span>
                        <span class="text-xs text-slate-500">Document</span>
                    </div>
                    <div class="p-4 overflow-x-auto">
                        <pre class="font-mono text-sm text-emerald-400 leading-relaxed">
{
  <span class="text-indigo-300">"id"</span>: <span class="text-amber-300">"unique_event_id_123"</span>,
  <span class="text-indigo-300">"name"</span>: <span class="text-amber-300">"é€±æœ«çƒ¤è‚‰æ´¾å°"</span>,
  <span class="text-indigo-300">"organizerId"</span>: <span class="text-amber-300">"user_device_id_abc"</span>,
  <span class="text-indigo-300">"createdAt"</span>: <span class="text-amber-300">"2023-10-27T10:00:00Z"</span>,
  <span class="text-indigo-300">"startDate"</span>: <span class="text-amber-300">"2023-10-27"</span>, <span class="text-slate-500">// é–å®šç¯„åœ</span>
  <span class="text-indigo-300">"endDate"</span>: <span class="text-amber-300">"2023-12-26"</span>,   <span class="text-slate-500">// Today + 60</span>
  <span class="text-indigo-300">"status"</span>: <span class="text-amber-300">"active"</span>
}</pre>
                    </div>
                </div>

                <!-- Participants Sub-collection -->
                <div class="bg-slate-800 rounded-xl overflow-hidden shadow-lg">
                    <div class="bg-slate-900 px-4 py-2 border-b border-slate-700 flex justify-between items-center">
                        <span class="text-indigo-400 font-mono text-sm">Sub-collection: participants</span>
                        <span class="text-xs text-slate-500">Sub-Document</span>
                    </div>
                    <div class="p-4 overflow-x-auto">
                        <pre class="font-mono text-sm text-sky-300 leading-relaxed">
{
  <span class="text-indigo-300">"id"</span>: <span class="text-amber-300">"participant_id_789"</span>,
  <span class="text-indigo-300">"name"</span>: <span class="text-amber-300">"Jason"</span>,
  <span class="text-indigo-300">"color"</span>: <span class="text-amber-300">"#ec4899"</span>, <span class="text-slate-500">// Assigned Color</span>
  <span class="text-indigo-300">"selectedDates"</span>: [
    <span class="text-amber-300">"2023-11-05"</span>,
    <span class="text-amber-300">"2023-11-06"</span>
  ],
  <span class="text-indigo-300">"updatedAt"</span>: <span class="text-amber-300">"2023-10-27T10:05:00Z"</span>
}</pre>
                    </div>
                </div>
            </div>
            <p class="text-sm text-slate-500 mt-4 italic">è¨»ï¼šæ–°å¢ `color` æ¬„ä½ä»¥æ”¯æ´è¦–è¦ºåŒ–åŠŸèƒ½ã€‚</p>
        </section>

    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- Configuration ---
        const COLORS = [
            '#ef4444', // Red
            '#f97316', // Orange
            '#f59e0b', // Amber
            '#84cc16', // Lime
            '#10b981', // Emerald
            '#06b6d4', // Cyan
            '#3b82f6', // Blue
            '#8b5cf6', // Violet
            '#d946ef', // Fuchsia
            '#f43f5e'  // Rose
        ];

        // --- State Management for Prototype ---
        const state = {
            step: 'landing', // landing, create, share, join, calendar, result, admin
            eventName: '',
            userName: '',
            userColor: '',
            selectedDates: new Set(), // Now stores 'YYYY-MM-DD' strings
            viewDate: new Date(), // Tracks the currently viewed month in the calendar
            participants: [], // Stores objects: { name, color, selectedDates[] }
            pendingDeleteIndex: null // Track which user is being deleted
        };

        const today = new Date();
        const futureDate = new Date();
        futureDate.setDate(today.getDate() + 60);

        // Utility to format date for comparison and storage
        function formatDateKey(date) {
            return date.toISOString().split('T')[0];
        }

        // --- Dummy Data Generator ---
        function generateDummyParticipants() {
            // Generates fake participants to simulate a group event
            const names = ["Alice", "Bob", "Charlie", "David"];
            const participants = [];
            
            // Generate 3-5 random dates for each dummy user in the next 30 days
            names.forEach((name, index) => {
                const pDates = [];
                const numDates = Math.floor(Math.random() * 5) + 2;
                for(let i=0; i<numDates; i++) {
                    const d = new Date(today);
                    d.setDate(today.getDate() + Math.floor(Math.random() * 30) + 1);
                    pDates.push(formatDateKey(d));
                }
                
                participants.push({
                    name: name,
                    color: COLORS[index % COLORS.length], // Assign colors sequentially
                    selectedDates: pDates
                });
            });
            return participants;
        }

        // --- Render Functions for Phone Screen ---

        function renderScreen() {
            const screen = document.getElementById('app-screen');
            screen.innerHTML = ''; // Clear

            if (state.step === 'landing') {
                renderLanding(screen);
                updateSpecPanel(1);
            } else if (state.step === 'create') {
                renderCreate(screen);
                updateSpecPanel(2);
            } else if (state.step === 'share') {
                renderShare(screen);
                updateSpecPanel(3);
            } else if (state.step === 'join') {
                renderJoin(screen);
                updateSpecPanel(4);
            } else if (state.step === 'calendar') {
                renderCalendar(screen);
                updateSpecPanel(5);
            } else if (state.step === 'result') {
                renderResult(screen);
                updateSpecPanel(6);
            } else if (state.step === 'admin') {
                renderAdmin(screen);
                updateSpecPanel(7);
            }
        }

        // 1. Landing Screen
        function renderLanding(container) {
            container.innerHTML = `
                <div class="flex-1 flex flex-col items-center justify-center p-6 space-y-6">
                    <div class="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center text-white text-3xl font-bold shadow-lg mb-4">Ev</div>
                    <h1 class="text-2xl font-bold text-slate-800 text-center">è¼•é¬†å®‰æ’èšæœƒ</h1>
                    <p class="text-center text-slate-500 text-sm">ç„¡éœ€è¨»å†Šï¼Œå³åˆ»å»ºç«‹æ´»å‹•ä¸¦é‚€è«‹æœ‹å‹æŠ•ç¥¨ã€‚</p>
                </div>
                <div class="p-6 bg-white border-t border-slate-100">
                    <button onclick="setState('create')" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl shadow-md transition transform active:scale-95">
                        å»ºç«‹æ–°æ´»å‹•
                    </button>
                </div>
            `;
        }

        // 2. Create Screen
        function renderCreate(container) {
            const dateStr = `${today.getMonth()+1}/${today.getDate()} è‡³ ${futureDate.getMonth()+1}/${futureDate.getDate()}`;
            container.innerHTML = `
                <div class="bg-white p-4 shadow-sm flex items-center">
                    <button onclick="setState('landing')" class="text-slate-400 mr-4">â†</button>
                    <h2 class="font-bold text-slate-800">å»ºç«‹æ´»å‹•</h2>
                </div>
                <div class="p-6 space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">æ´»å‹•åç¨±</label>
                        <input type="text" id="event-name-input" placeholder="ä¾‹å¦‚ï¼šé€±äº”æ™šé¤" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                        <p class="text-xs text-blue-800 font-semibold mb-1">ğŸ“… è‡ªå‹•è¨­å®šæ—¥æœŸç¯„åœ</p>
                        <p class="text-xs text-blue-600">å°‡é–‹æ”¾é¸æ“‡ï¼š${dateStr} (æœªä¾†60å¤©)</p>
                    </div>
                </div>
                <div class="mt-auto p-6 bg-white border-t border-slate-100 sticky bottom-0">
                    <button onclick="handleCreateEvent()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl shadow-md transition">
                        ç”¢ç”Ÿæ´»å‹•é€£çµ
                    </button>
                </div>
            `;
        }

        // 3. Share Screen
        function renderShare(container) {
            container.innerHTML = `
                <div class="bg-white p-4 shadow-sm flex justify-between items-center">
                    <h2 class="font-bold text-slate-800">æ´»å‹•åˆ†äº«</h2>
                     <button onclick="setState('admin')" class="text-slate-500 text-xs font-bold border border-slate-200 px-2 py-1 rounded bg-slate-50 hover:bg-slate-100">
                        âš™ï¸ ç®¡ç†
                    </button>
                </div>
                <div class="flex-1 flex flex-col items-center justify-center p-6 space-y-6 bg-slate-50">
                    <div class="w-16 h-16 bg-green-100 text-green-600 rounded-full flex items-center justify-center text-2xl mb-2">âœ“</div>
                    <h2 class="text-xl font-bold text-slate-800">æ´»å‹•å·²å»ºç«‹ï¼</h2>
                    <div class="w-full bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                        <p class="text-xs text-slate-400 mb-1">æ´»å‹•é€£çµ</p>
                        <div class="flex items-center justify-between bg-slate-100 p-2 rounded text-sm text-slate-600 font-mono">
                            <span>app.com/e/xYz123</span>
                            <span class="text-indigo-600 font-bold cursor-pointer">è¤‡è£½</span>
                        </div>
                    </div>
                    <p class="text-sm text-slate-500 text-center">åˆ†äº«æ­¤é€£çµçµ¦æœ‹å‹ï¼Œæˆ–ç›´æ¥é–‹å§‹å¡«å¯«ä½ çš„æ™‚é–“ã€‚</p>
                </div>
                <div class="p-6 bg-white border-t border-slate-100">
                    <button onclick="setState('join')" class="w-full bg-white border-2 border-indigo-600 text-indigo-600 font-bold py-3 px-4 rounded-xl transition hover:bg-indigo-50">
                        é€²å…¥æ´»å‹•çœ‹æ¿
                    </button>
                </div>
            `;
        }

        // 4. Join/Identify Screen (Updated logic for existing users)
        function renderJoin(container) {
            container.innerHTML = `
                <div class="bg-indigo-600 p-6 text-white pt-10 pb-8">
                    <h1 class="text-2xl font-bold">${state.eventName || 'æœªå‘½åæ´»å‹•'}</h1>
                    <p class="text-indigo-200 text-sm mt-1">Organizer é‚€è«‹ä½ å¡«å¯«æ™‚é–“</p>
                </div>
                <div class="p-6 -mt-6 bg-white rounded-t-3xl flex-1 shadow-inner">
                    <div class="space-y-4">
                        <label class="block text-sm font-medium text-slate-700">ä½ çš„æš±ç¨±</label>
                        <input type="text" id="user-name-input" placeholder="è¼¸å…¥åç¨±" class="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                        <p class="text-xs text-slate-400">è‹¥è¼¸å…¥ç›¸åŒåç¨±ï¼Œå°‡æœƒè¼‰å…¥èˆŠè³‡æ–™ä¾›æ‚¨ä¿®æ”¹ã€‚</p>
                        <button onclick="startSelecting()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl shadow-md transition mt-4">
                            é–‹å§‹é¸æ“‡æ™‚é–“
                        </button>
                    </div>
                </div>
            `;
        }

        // 5. Calendar Selection Screen (Updated with Real Logic)
        function renderCalendar(container) {
            const currentYear = state.viewDate.getFullYear();
            const currentMonth = state.viewDate.getMonth();
            const monthNames = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"];
            
            // Calculate calendar grid
            const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay(); // 0 is Sunday
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            let daysHTML = '';
            
            // Empty slots for start day
            for(let i=0; i<firstDayOfMonth; i++) {
                daysHTML += `<div class="aspect-square"></div>`;
            }

            // Normalise today for comparison
            const todayMidnight = new Date(today);
            todayMidnight.setHours(0,0,0,0);
            
            const maxDateMidnight = new Date(futureDate);
            maxDateMidnight.setHours(0,0,0,0);

            // Generate days
            for(let i=1; i<=daysInMonth; i++) {
                const checkDate = new Date(currentYear, currentMonth, i);
                const dateKey = formatDateKey(checkDate);
                const isSelected = state.selectedDates.has(dateKey);
                
                // Logic: Disable if in past OR > 60 days
                let isDisabled = checkDate < todayMidnight || checkDate > maxDateMidnight;
                
                let bgClass = '';
                let clickHandler = '';
                let content = `${i}`;
                
                if (isDisabled) {
                    bgClass = 'bg-slate-100 text-slate-300 cursor-not-allowed';
                } else if (isSelected) {
                    bgClass = 'bg-indigo-600 text-white shadow-md cursor-pointer';
                    clickHandler = `onclick="toggleDate('${dateKey}')"`;
                    content += '<div class="absolute bottom-1 right-1 text-[8px]">âœ“</div>';
                } else {
                    bgClass = 'bg-white text-slate-700 border border-slate-100 hover:bg-slate-50 cursor-pointer';
                    clickHandler = `onclick="toggleDate('${dateKey}')"`;
                }
                
                daysHTML += `
                    <div ${clickHandler} class="${bgClass} aspect-square rounded-lg flex items-center justify-center text-sm font-medium relative transition-all duration-200 select-none">
                        ${content}
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="bg-white p-4 shadow-sm flex justify-between items-center sticky top-0 z-10">
                    <h2 class="font-bold text-slate-800 text-lg">${monthNames[currentMonth]} ${currentYear}</h2>
                    <div class="space-x-2">
                        <button onclick="changeMonth(-1)" class="w-8 h-8 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 transition">â†</button>
                        <button onclick="changeMonth(1)" class="w-8 h-8 rounded-full bg-slate-100 text-slate-600 hover:bg-slate-200 transition">â†’</button>
                    </div>
                </div>
                
                <div class="flex-1 overflow-y-auto p-4">
                    <div class="grid grid-cols-7 gap-2 mb-2 text-center text-xs text-slate-400 font-bold">
                        <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
                    </div>
                    <div class="grid grid-cols-7 gap-2">
                        ${daysHTML}
                    </div>
                </div>

                <div class="p-4 bg-white border-t border-slate-100 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] sticky bottom-0">
                    <div class="flex justify-between items-center mb-3">
                        <div class="flex items-center space-x-2">
                            <span class="w-3 h-3 rounded-full" style="background-color: ${state.userColor}"></span>
                            <span class="text-xs text-slate-500">ä½ çš„é¡è‰²: ${state.userName}</span>
                        </div>
                        <span class="text-xs text-slate-500">å·²é¸: <span class="font-bold text-indigo-600 text-base">${state.selectedDates.size}</span> å¤©</span>
                    </div>
                    <button onclick="submitDates()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-xl shadow transition">
                        ${state.participants.find(p => p.name === state.userName) ? 'æ›´æ–°é¸æ“‡' : 'æäº¤'}
                    </button>
                </div>
            `;
        }

        // 6. Result Screen (Updated for Dot Voting)
        function renderResult(container) {
             // We reuse the current viewDate to show results on the calendar
            const currentYear = state.viewDate.getFullYear();
            const currentMonth = state.viewDate.getMonth();
            const firstDayOfMonth = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            const monthNames = ["1æœˆ", "2æœˆ", "3æœˆ", "4æœˆ", "5æœˆ", "6æœˆ", "7æœˆ", "8æœˆ", "9æœˆ", "10æœˆ", "11æœˆ", "12æœˆ"];

            // 1. Participant Legend (Table)
            let participantTableHTML = `
                <div class="bg-slate-50 p-4 border-b border-indigo-100">
                    <h3 class="text-xs font-bold text-slate-400 uppercase mb-2">åƒèˆ‡è€… (é»é»å°ç…§è¡¨)</h3>
                    <div class="flex flex-wrap gap-2">
            `;
            
            // Add Dummy Participants + Current User (if submitted)
            state.participants.forEach(p => {
                participantTableHTML += `
                    <div class="flex items-center space-x-1.5 bg-white px-2 py-1 rounded-full border border-slate-200 shadow-sm">
                        <span class="w-3 h-3 rounded-full" style="background-color: ${p.color}"></span>
                        <span class="text-xs font-medium text-slate-700">${p.name}</span>
                    </div>
                `;
            });
            participantTableHTML += `</div></div>`;

            // 2. Calendar Grid with Dots
            let daysHTML = '';
            for(let i=0; i<firstDayOfMonth; i++) {
                daysHTML += `<div class="aspect-square"></div>`;
            }

            const todayMidnight = new Date(today);
            todayMidnight.setHours(0,0,0,0);
            
            const maxDateMidnight = new Date(futureDate);
            maxDateMidnight.setHours(0,0,0,0);

            // Calculate Best Day for Crown
            let bestDayCount = 0;
            // Map: dateString -> count
            const dateCounts = {};
            state.participants.forEach(p => {
                p.selectedDates.forEach(d => {
                    dateCounts[d] = (dateCounts[d] || 0) + 1;
                    if (dateCounts[d] > bestDayCount) bestDayCount = dateCounts[d];
                });
            });

            for(let i=1; i<=daysInMonth; i++) {
                const checkDate = new Date(currentYear, currentMonth, i);
                const dateKey = formatDateKey(checkDate);
                // Updated logic: Disable if past OR > 60 days
                let isDisabled = checkDate < todayMidnight || checkDate > maxDateMidnight; 

                // Find users who selected this date
                const usersOnDate = state.participants.filter(p => p.selectedDates.includes(dateKey));
                const count = usersOnDate.length;
                const isBestDay = (!isDisabled && count > 0 && count === bestDayCount);

                let bgClass = 'bg-white border border-slate-100';
                if (isDisabled) {
                    bgClass = 'bg-slate-50 text-slate-300';
                } else if (isBestDay) {
                    bgClass = 'bg-yellow-50 border-2 border-yellow-400 relative shadow-sm';
                }

                const crown = isBestDay ? `<div class="absolute -top-3 left-1/2 transform -translate-x-1/2 text-[10px] z-10">ğŸ‘‘</div>` : '';

                // Generate Dots HTML
                let dotsHTML = '';
                if (!isDisabled && count > 0) {
                    dotsHTML = `<div class="flex flex-wrap justify-center gap-[1px] px-0.5 mt-1">`;
                    usersOnDate.forEach(u => {
                        dotsHTML += `<div class="w-[3px] h-[3px] rounded-full" style="background-color: ${u.color}"></div>`;
                    });
                    dotsHTML += `</div>`;
                }

                daysHTML += `
                    <div class="${bgClass} aspect-square rounded-lg flex flex-col items-center justify-start pt-1 text-sm font-bold relative transition-all min-h-[44px]">
                        ${crown}
                        <span class="${isDisabled ? '' : 'text-slate-600'}">${i}</span>
                        ${dotsHTML}
                    </div>
                `;
            }

            container.innerHTML = `
                <div class="bg-white p-4 shadow-sm border-b flex justify-between items-center sticky top-0 z-20">
                    <h2 class="font-bold text-slate-800 truncate pr-2">${state.eventName}</h2>
                    <div class="flex space-x-2">
                        <button class="text-indigo-600 text-xs font-bold border border-indigo-100 px-2 py-1 rounded bg-indigo-50">åˆ†äº«</button>
                        <button onclick="setState('admin')" class="text-slate-500 text-xs font-bold border border-slate-200 px-2 py-1 rounded bg-slate-50 hover:bg-slate-100">
                            âš™ï¸ ç®¡ç†
                        </button>
                    </div>
                </div>
                
                ${participantTableHTML}

                <div class="bg-white p-2 border-b flex justify-between items-center text-sm text-slate-500">
                     <span>${monthNames[currentMonth]} ${currentYear}</span>
                     <div class="space-x-1">
                        <button onclick="changeMonth(-1)" class="px-2 bg-slate-100 rounded">â†</button>
                        <button onclick="changeMonth(1)" class="px-2 bg-slate-100 rounded">â†’</button>
                    </div>
                </div>

                <div class="flex-1 overflow-y-auto p-4">
                    <div class="grid grid-cols-7 gap-2 mb-2 text-center text-xs text-slate-400 font-bold">
                        <div>æ—¥</div><div>ä¸€</div><div>äºŒ</div><div>ä¸‰</div><div>å››</div><div>äº”</div><div>å…­</div>
                    </div>
                    <div class="grid grid-cols-7 gap-2">
                        ${daysHTML}
                    </div>
                </div>
                
                 <div class="p-4 bg-white border-t border-slate-100 sticky bottom-0 z-10 flex space-x-2">
                    <button onclick="joinAsNewUser()" class="flex-1 bg-indigo-100 hover:bg-indigo-200 text-indigo-700 font-bold py-3 px-4 rounded-xl transition text-sm">
                        æ¨¡æ“¬å¦ä¸€ä½ä½¿ç”¨è€…
                    </button>
                    <button onclick="resetSimulation()" class="flex-1 bg-slate-100 hover:bg-slate-200 text-slate-600 font-bold py-3 px-4 rounded-xl transition text-sm">
                        å®Œå…¨é‡ç½®
                    </button>
                </div>
            `;
        }

        // 7. Admin Screen (Updated: 2-step delete)
        function renderAdmin(container) {
            let listHTML = '';
            if (state.participants.length === 0) {
                listHTML = `<div class="text-center text-slate-400 py-8 text-sm">ç›®å‰æ²’æœ‰åƒèˆ‡è€…</div>`;
            } else {
                state.participants.forEach((p, index) => {
                    let actionButtons = '';
                    if (state.pendingDeleteIndex === index) {
                        actionButtons = `
                            <div class="flex space-x-1">
                                <button onclick="confirmDelete(${index})" class="text-white bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-xs font-bold transition">ç¢ºå®š?</button>
                                <button onclick="cancelDelete()" class="text-slate-500 bg-slate-100 hover:bg-slate-200 px-3 py-1 rounded text-xs font-bold transition">å–æ¶ˆ</button>
                            </div>
                        `;
                    } else {
                        actionButtons = `
                            <button onclick="requestDelete(${index})" class="text-red-500 hover:bg-red-50 px-3 py-1 rounded text-xs font-bold transition">
                                ç§»é™¤
                            </button>
                        `;
                    }

                    listHTML += `
                        <div class="flex items-center justify-between bg-white p-3 rounded-lg border border-slate-200 shadow-sm mb-2">
                            <div class="flex items-center space-x-3">
                                <span class="w-4 h-4 rounded-full shadow-sm border border-slate-100" style="background-color: ${p.color}"></span>
                                <div>
                                    <p class="text-sm font-bold text-slate-800">${p.name}</p>
                                    <p class="text-xs text-slate-400">å·²é¸ ${p.selectedDates.length} å¤©</p>
                                </div>
                            </div>
                            ${actionButtons}
                        </div>
                    `;
                });
            }

            container.innerHTML = `
                <div class="bg-slate-800 p-4 shadow-md flex items-center justify-between text-white">
                    <div class="flex items-center space-x-2">
                        <button onclick="setState('result')" class="text-slate-300 hover:text-white">â† è¿”å›</button>
                        <h2 class="font-bold">å¾Œå°ç®¡ç†</h2>
                    </div>
                    <div class="text-xs px-2 py-1 bg-slate-700 rounded text-slate-300">Organizer Only</div>
                </div>
                
                <div class="p-4 flex-1 overflow-y-auto bg-slate-50">
                    <div class="mb-4">
                        <h3 class="text-sm font-bold text-slate-600 mb-2">åƒèˆ‡è€…åå–® (${state.participants.length})</h3>
                        ${listHTML}
                    </div>
                </div>

                <div class="p-4 bg-white border-t border-slate-100 sticky bottom-0">
                    <p class="text-xs text-slate-400 text-center">ç§»é™¤åƒèˆ‡è€…å¾Œï¼Œè©²ç”¨æˆ¶çš„é¸æ“‡å°‡ç«‹å³å¾æ—¥æ›†ä¸­æ¶ˆå¤±ã€‚</p>
                </div>
            `;
        }


        // --- Controller Logic ---

        function setState(newState) {
            state.step = newState;
            state.pendingDeleteIndex = null; // Clear pending delete state when changing screens
            renderScreen();
        }

        function handleCreateEvent() {
            const input = document.getElementById('event-name-input');
            if (input && input.value) {
                state.eventName = input.value;
                // Init dummy participants on create
                state.participants = generateDummyParticipants();
                setState('share');
            } else {
                alert('è«‹è¼¸å…¥æ´»å‹•åç¨±');
            }
        }

        function startSelecting() {
            const input = document.getElementById('user-name-input');
            if (input && input.value) {
                const name = input.value.trim();
                state.userName = name;
                
                // æª¢æŸ¥æ˜¯å¦ç‚ºç¾æœ‰ä½¿ç”¨è€…
                const existingUser = state.participants.find(p => p.name === name);
                
                if (existingUser) {
                    // èˆŠç”¨æˆ¶ï¼šè¼‰å…¥èˆŠè³‡æ–™
                    state.userColor = existingUser.color;
                    state.selectedDates = new Set(existingUser.selectedDates);
                    alert(`æ­¡è¿å›ä¾†ï¼Œ${name}ï¼å·²è¼‰å…¥æ‚¨ä¹‹å‰çš„é¸æ“‡ä¾›æ‚¨ä¿®æ”¹ã€‚`);
                } else {
                    // æ–°ç”¨æˆ¶ï¼šåˆ†é…æ–°é¡è‰²
                    const nextColorIndex = state.participants.length % COLORS.length;
                    state.userColor = COLORS[nextColorIndex];
                    state.selectedDates = new Set(); // ç¢ºä¿æ–°ç”¨æˆ¶å¾ç©ºé–‹å§‹
                }
                
                setState('calendar');
            } else {
                alert('è«‹è¼¸å…¥æ‚¨çš„åç¨±');
            }
        }

        function toggleDate(dateKey) {
            if (state.selectedDates.has(dateKey)) {
                state.selectedDates.delete(dateKey);
            } else {
                state.selectedDates.add(dateKey);
            }
            renderScreen(); 
        }

        function changeMonth(offset) {
            // Update viewDate
            const newDate = new Date(state.viewDate);
            newDate.setMonth(newDate.getMonth() + offset);
            state.viewDate = newDate;
            renderScreen();
        }

        function submitDates() {
            // Check if user exists to update or push
            const existingIndex = state.participants.findIndex(p => p.name === state.userName);
            
            const newRecord = {
                name: state.userName,
                color: state.userColor,
                selectedDates: Array.from(state.selectedDates)
            };

            if (existingIndex >= 0) {
                // æ›´æ–°ç¾æœ‰ç´€éŒ„ (Overwrite)
                state.participants[existingIndex] = newRecord;
            } else {
                // æ–°å¢ç´€éŒ„
                state.participants.push(newRecord);
            }
            setState('result');
        }

        // New Logic for Deletion (No confirm dialog)
        function requestDelete(index) {
            state.pendingDeleteIndex = index;
            renderScreen();
        }

        function confirmDelete(index) {
            state.participants.splice(index, 1);
            state.pendingDeleteIndex = null;
            renderScreen();
        }

        function cancelDelete() {
            state.pendingDeleteIndex = null;
            renderScreen();
        }

        function joinAsNewUser() {
            // æ¸…é™¤ç•¶å‰ä½¿ç”¨è€…ç‹€æ…‹ï¼Œä½†ä¿ç•™æ´»å‹•å’Œåƒèˆ‡è€…è³‡æ–™
            state.userName = '';
            state.userColor = '';
            state.selectedDates.clear();
            setState('join');
        }

        function resetSimulation() {
            // å®Œå…¨é‡ç½®
            state.eventName = '';
            state.userName = '';
            state.userColor = '';
            state.selectedDates.clear();
            state.participants = [];
            state.viewDate = new Date(today);
            setState('landing');
        }

        // --- Spec Panel Update Logic ---
        function updateSpecPanel(stepIndex) {
            const titleEl = document.getElementById('spec-title');
            const badgeEl = document.getElementById('step-badge');
            const contentEl = document.getElementById('spec-content');

            // Reset flow steps
            [1,2,3,4].forEach(i => {
                const el = document.getElementById(`flow-step-${i}`);
                if (el) el.className = 'flex-1 p-2 bg-slate-200 text-slate-500 rounded transition-colors';
            });

            // Highlight current flow step (Admin maps to Create/Organizer domain 1)
            const flowMap = { 1:1, 2:1, 3:2, 4:3, 5:3, 6:4, 7:1 };
            const currentFlow = flowMap[stepIndex] || 1;
            const flowEl = document.getElementById(`flow-step-${currentFlow}`);
            if (flowEl) flowEl.className = 'flex-1 p-2 bg-indigo-600 text-white rounded shadow-sm transition-colors font-bold';

            if (stepIndex === 1) {
                badgeEl.textContent = 'Step 1: Landing';
                titleEl.textContent = '2.1 ç™¼èµ·äººæµç¨‹ï¼šå…¥å£';
                contentEl.innerHTML = `
                    <p>å°æ‡‰è¦æ ¼ <strong>2.1</strong>ï¼š</p>
                    <ul class="list-disc list-inside space-y-1 text-sm bg-slate-50 p-3 rounded">
                         <li><strong>æ ¸å¿ƒåƒ¹å€¼ï¼š</strong> ç°¡å–®ã€ç„¡éœ€è¨»å†Šã€‚</li>
                         <li><strong>æ“ä½œï¼š</strong> å–®ä¸€ CTA æŒ‰éˆ•å¼•å°å»ºç«‹æµç¨‹ã€‚</li>
                    </ul>
                `;
            } else if (stepIndex === 2) {
                badgeEl.textContent = 'Step 2: Setup';
                titleEl.textContent = '2.1 ç™¼èµ·äººæµç¨‹ï¼šè¨­å®š';
                contentEl.innerHTML = `
                    <p>å°æ‡‰è¦æ ¼ <strong>2.1</strong>ï¼š</p>
                    <ul class="list-disc list-inside space-y-1 text-sm bg-slate-50 p-3 rounded">
                         <li><strong>å¿…å¡«ï¼š</strong> æ´»å‹•åç¨±ã€‚</li>
                         <li><strong>ç³»çµ±é‚è¼¯ï¼š</strong> è‡ªå‹•é–å®šæœªä¾† 60 å¤©ã€‚ç™¼èµ·äººç„¡éœ€æ‰‹å‹•é¸æ“‡æ—¥æœŸï¼Œç°¡åŒ–æµç¨‹ã€‚</li>
                         <li><strong>ç›®æ¨™ï¼š</strong> é™ä½å»ºç«‹é–€æª» (Mobile-first)ã€‚</li>
                    </ul>
                `;
            } else if (stepIndex === 3) {
                badgeEl.textContent = 'Step 3: Share';
                titleEl.textContent = '2.1 ç™¼èµ·äººæµç¨‹ï¼šåˆ†äº«';
                contentEl.innerHTML = `
                    <p>å°æ‡‰è¦æ ¼ <strong>2.1</strong>ï¼š</p>
                    <ul class="list-disc list-inside space-y-1 text-sm bg-slate-50 p-3 rounded">
                         <li><strong>ç”¢å‡ºï¼š</strong> å”¯ä¸€æ´»å‹•é€£çµ (Event ID)ã€‚</li>
                         <li><strong>å¾Œå°å…¥å£ï¼š</strong> ç™¼èµ·äººå¯åœ¨æ­¤é€²å…¥ç®¡ç†å¾Œå° (Admin)ã€‚</li>
                    </ul>
                `;
            } else if (stepIndex === 4) {
                badgeEl.textContent = 'Step 4: Join';
                titleEl.textContent = '2.2 åƒèˆ‡è€…æµç¨‹ï¼šè­˜åˆ¥';
                contentEl.innerHTML = `
                    <p>å°æ‡‰è¦æ ¼ <strong>2.2</strong>ï¼š</p>
                    <ul class="list-disc list-inside space-y-1 text-sm bg-slate-50 p-3 rounded">
                         <li><strong>å”¯è®€è³‡è¨Šï¼š</strong> é¡¯ç¤ºæ´»å‹•åç¨±ã€‚</li>
                         <li><strong>èº«ä»½è­˜åˆ¥ï¼š</strong> è‹¥è¼¸å…¥å·²å­˜åœ¨çš„åç¨±ï¼Œç³»çµ±å°‡é€²å…¥ã€Œä¿®æ”¹æ¨¡å¼ã€ï¼Œè¼‰å…¥èˆŠè³‡æ–™ä¾›è¦†è“‹ã€‚</li>
                         <li><strong>é¡è‰²åˆ†é…ï¼š</strong> èˆŠç”¨æˆ¶ä¿ç•™åŸè‰²ï¼Œæ–°ç”¨æˆ¶åˆ†é…æ–°è‰²ã€‚</li>
                    </ul>
                `;
            } else if (stepIndex === 5) {
                badgeEl.textContent = 'Step 5: Select';
                titleEl.textContent = '3.0 æ—¥æ›†äº’å‹•é‚è¼¯';
                contentEl.innerHTML = `
                    <p>å°æ‡‰è¦æ ¼ <strong>3.1 & 3.2</strong>ï¼š</p>
                    <ul class="list-disc list-inside space-y-1 text-sm bg-slate-50 p-3 rounded">
                         <li><strong>è¦–åœ–ï¼š</strong> æœˆä»½è¦–åœ– (Month View)ã€‚</li>
                         <li><strong>äº’å‹•ï¼š</strong> Toggle (é¸å–/å–æ¶ˆ)ã€‚</li>
                         <li><strong>ç‹€æ…‹ï¼š</strong> é¸å–æ™‚é«˜äº® (Primary Color)ã€‚</li>
                         <li><strong>é™åˆ¶ï¼š</strong> åªèƒ½æ“ä½œè‡ªå·±çš„ç‹€æ…‹ï¼Œéå»çš„æ—¥æœŸèˆ‡è¶…é60å¤©å¾Œçš„æ—¥æœŸçš†ç‚ºç°è‰²ä¸å¯é¸ã€‚</li>
                    </ul>
                `;
            } else if (stepIndex === 6) {
                badgeEl.textContent = 'Step 6: Result';
                titleEl.textContent = '3.3 çµæœè¦–è¦ºåŒ– (Dot Voting)';
                contentEl.innerHTML = `
                    <p>å°æ‡‰è¦æ ¼ <strong>3.3 & 4.0</strong>ï¼š</p>
                    <ul class="list-disc list-inside space-y-1 text-sm bg-slate-50 p-3 rounded">
                         <li><strong>Dot Votingï¼š</strong> æ¯å€‹é¡è‰²é»ä»£è¡¨ä¸€ä½åƒèˆ‡è€…ã€‚</li>
                         <li><strong>Legendï¼š</strong> ä¸Šæ–¹è¡¨æ ¼åˆ—å‡ºåå­—èˆ‡é¡è‰²çš„å°ç…§ã€‚</li>
                         <li><strong>Best Dayï¼š</strong> é‡‘è‰²æ¨™è¨˜æœ€å¤šäººå¯å‡ºå¸­çš„æ—¥å­ã€‚</li>
                         <li><strong>ç®¡ç†åŠŸèƒ½ï¼š</strong> ç™¼èµ·äººå¯å¾æ­¤é€²å…¥ç®¡ç†ä»‹é¢ã€‚</li>
                    </ul>
                `;
            } else if (stepIndex === 7) {
                badgeEl.textContent = 'Step 7: Admin';
                titleEl.textContent = '4.1 ç™¼èµ·äººå¾Œå°ç®¡ç†';
                contentEl.innerHTML = `
                    <p>å°æ‡‰è¦æ ¼ <strong>Admin (New)</strong>ï¼š</p>
                    <ul class="list-disc list-inside space-y-1 text-sm bg-slate-50 p-3 rounded">
                         <li><strong>æ¬Šé™ï¼š</strong> åƒ…ç™¼èµ·äººå¯è¦‹ (Prototype ä¸­æ¨¡æ“¬)ã€‚</li>
                         <li><strong>åŠŸèƒ½ï¼š</strong> ç€è¦½å®Œæ•´åå–®ã€ç§»é™¤åƒèˆ‡è€…ã€‚</li>
                         <li><strong>é€£å‹•ï¼š</strong> ç§»é™¤å¾Œï¼Œçµæœé é¢çš„é»é»èˆ‡çµ±è¨ˆæ•¸æ“šæœƒå³æ™‚æ›´æ–°ã€‚</li>
                    </ul>
                `;
            }
        }

        // --- Initialization ---
        window.onload = function() {
            // Start Simulation
            renderScreen();
        };

    </script>
</body>
</html>